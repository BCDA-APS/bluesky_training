
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Count the scaler &#8212; APS Bluesky Training</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'howto/_count_scaler';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Heater Simulation using synApps epid and transform records" href="_custom_heater_positioner.html" />
    <link rel="prev" title="First steps with bluesky-queueserver" href="_bluesky_queueserver.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">APS Bluesky Training</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../instrument/index.html">
    Instrument
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../example/index.html">
    Examples
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    How-To Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutor/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../changes.html">
    Changes
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../instrument/index.html">
    Instrument
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../example/index.html">
    Examples
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    How-To Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutor/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../changes.html">
    Changes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="bluesky_cheat_sheet.html">Bluesky Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="_ad_v_motors.html">Scan Area Detector v. Motor</a></li>
<li class="toctree-l1"><a class="reference internal" href="_after_measurement.html">Accessing data later, after the measurement</a></li>
<li class="toctree-l1"><a class="reference internal" href="_basic_aps_info.html">APS Accelerator Information for Beamlines</a></li>
<li class="toctree-l1"><a class="reference internal" href="_basic_motor_scaler_scan.html">Minimal: Scan scaler <em>vs</em> motor</a></li>
<li class="toctree-l1"><a class="reference internal" href="_bluesky_queueserver.html">First steps with bluesky-queueserver</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Count the scaler</a></li>
<li class="toctree-l1"><a class="reference internal" href="_custom_heater_positioner.html">Heater Simulation using synApps epid and transform records</a></li>
<li class="toctree-l1"><a class="reference internal" href="_custom_plan.html">Custom bluesky plan</a></li>

<li class="toctree-l1"><a class="reference internal" href="_data_management.html">Setup APS Data Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="_doodle.html">Linux Command &amp; Wait for Finish</a></li>
<li class="toctree-l1"><a class="reference internal" href="_dynamic_limits_2motor.html">Dynamic Limits for Two Motors</a></li>
<li class="toctree-l1"><a class="reference internal" href="_epics_proc_field.html">Trigger a Device with the EPICS record .PROC field</a></li>
<li class="toctree-l1"><a class="reference internal" href="_images_darks_flats.html">Images, Darks, &amp; whites with EPICS area detector, ophyd, and Bluesky</a></li>
<li class="toctree-l1"><a class="reference internal" href="_lineup_1d_peak.html">Lineup a 1-D peak : scan detector <em>v</em> motor</a></li>
<li class="toctree-l1"><a class="reference internal" href="_locate_image_peak.html">Locate peak on 2-D area detector image</a></li>
<li class="toctree-l1"><a class="reference internal" href="_plot_x_y_databroker.html">Plot x, y data from a databroker run</a></li>
<li class="toctree-l1"><a class="reference internal" href="_synapps_busy.html">synApps <em>busy</em> record</a></li>
<li class="toctree-l1"><a class="reference internal" href="_synapps_sscan_1d_flyer.html">synApps <em>sscan</em> as 1D Flyer</a></li>
<li class="toctree-l1"><a class="reference internal" href="_temperature_controller_swait.html">Simulate a temperature controller with an EPICS <code class="docutils literal notranslate"><span class="pre">swait</span></code> record</a></li>
<li class="toctree-l1"><a class="reference internal" href="_time_scan.html">Time Series</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">How-To Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Count the scaler</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Count-the-scaler">
<h1>Count the scaler<a class="headerlink" href="#Count-the-scaler" title="Link to this heading">#</a></h1>
<p>From <em>APS Python Training for Bluesky Data Acquisition</em>.</p>
<p><strong>Objective</strong></p>
<p>In this notebook, we show how to count the scaler:</p>
<ul class="simple">
<li><p>on the command line</p></li>
<li><p>using ophyd</p></li>
<li><p>using the bluesky RunEngine</p></li>
</ul>
<p>We also show how to:</p>
<ul class="simple">
<li><p>set the counting time</p></li>
<li><p>choose certain channels for data acquisition</p></li>
</ul>
<section id="Start-the-instrument-package">
<h2>Start the <code class="docutils literal notranslate"><span class="pre">instrument</span></code> package<a class="headerlink" href="#Start-the-instrument-package" title="Link to this heading">#</a></h2>
<p>Our instrument package is in the <code class="docutils literal notranslate"><span class="pre">bluesky</span></code> subdirectory here so we add that to the search path before importing it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span><span class="o">,</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;bluesky&quot;</span><span class="p">))</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">instrument.collection</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/home/prjemian/bluesky/instrument/_iconfig.py
Activating auto-logging. Current session state plus future input saved.
Filename       : /home/prjemian/Documents/projects/BCDA-APS/bluesky_training/docs/source/howto/.logs/ipython_console.log
Mode           : rotate
Output logging : True
Raw input log  : False
Timestamping   : True
State          : active
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
I Thu-13:07:12 - ############################################################ startup
I Thu-13:07:12 - logging started
I Thu-13:07:12 - logging level = 10
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/session_logs.py
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/collection.py
I Thu-13:07:12 - CONDA_PREFIX = /home/prjemian/.conda/envs/bluesky_2023_2
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Exception reporting mode: Minimal
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
I Thu-13:07:12 - xmode exception level: &#39;Minimal&#39;
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/mpl/notebook.py
I Thu-13:07:12 - #### Bluesky Framework ####
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/framework/check_python.py
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/framework/check_bluesky.py
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/framework/initialize.py
I Thu-13:07:12 - RunEngine metadata saved in directory: /home/prjemian/Bluesky_RunEngine_md
I Thu-13:07:12 - using databroker catalog &#39;training&#39;
I Thu-13:07:12 - using ophyd control layer: pyepics
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/framework/metadata.py
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/epics_signal_config.py
I Thu-13:07:12 - Using RunEngine metadata for scan_id
I Thu-13:07:12 - #### Devices ####
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/devices/area_detector.py
I Thu-13:07:12 - /home/prjemian/bluesky/instrument/devices/calculation_records.py
I Thu-13:07:14 - /home/prjemian/bluesky/instrument/devices/fourc_diffractometer.py
I Thu-13:07:15 - /home/prjemian/bluesky/instrument/devices/ioc_stats.py
I Thu-13:07:15 - /home/prjemian/bluesky/instrument/devices/kohzu_monochromator.py
I Thu-13:07:15 - /home/prjemian/bluesky/instrument/devices/motors.py
I Thu-13:07:15 - /home/prjemian/bluesky/instrument/devices/noisy_detector.py
I Thu-13:07:15 - /home/prjemian/bluesky/instrument/devices/scaler.py
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/devices/shutter_simulator.py
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/devices/simulated_fourc.py
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/devices/simulated_kappa.py
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/devices/slits.py
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/devices/sixc_diffractometer.py
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/devices/temperature_signal.py
I Thu-13:07:16 - #### Callbacks ####
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/callbacks/spec_data_file_writer.py
I Thu-13:07:16 - #### Plans ####
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/plans/lup_plan.py
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/plans/peak_finder_example.py
I Thu-13:07:16 - /home/prjemian/bluesky/instrument/utils/image_analysis.py
I Thu-13:07:16 - #### Utilities ####
I Thu-13:07:16 - writing to SPEC file: /home/prjemian/Documents/projects/BCDA-APS/bluesky_training/docs/source/howto/20230413-130716.dat
I Thu-13:07:16 -    &gt;&gt;&gt;&gt;   Using default SPEC file name   &lt;&lt;&lt;&lt;
I Thu-13:07:16 -    file will be created when bluesky ends its next scan
I Thu-13:07:16 -    to change SPEC file, use command:   newSpecFile(&#39;title&#39;)
I Thu-13:07:16 - #### Startup is complete. ####
</pre></div></div>
</div>
</section>
<section id="A-closer-look-at-the-EPICS-scaler">
<h2>A closer look at the EPICS scaler<a class="headerlink" href="#A-closer-look-at-the-EPICS-scaler" title="Link to this heading">#</a></h2>
<p>A scaler is a device that counts digital pulses from a pulse detector such as a scintillation counter or from photodiodes or ionization chamber with pulse chain electronics. Scalers have many channels, some of which might have no associated detector. Our scaler (<code class="docutils literal notranslate"><span class="pre">scaler1</span></code>) is a simulated device that records a random number of pulses in each channel. We are only interested in the channels that have names provided by users in the GUI screens. In this control screen for our scaler, only a few of
the channels are named:</p>
<img alt="``scaler`` GUI" src="../_images/scaler.png" />
<p>Let’s configure <code class="docutils literal notranslate"><span class="pre">scaler1</span></code> to report only the <code class="docutils literal notranslate"><span class="pre">scint</span></code> and <code class="docutils literal notranslate"><span class="pre">I0</span></code> channels (plus the count time channel which will <em>always</em> be included). Keep in mind that the argument to this function is a Python list, so the channel names must be enclosed with <code class="docutils literal notranslate"><span class="pre">[]</span></code>. The function does not return a result. If something <em>is</em> printed, there is an error to be fixed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler1</span><span class="o">.</span><span class="n">select_channels</span><span class="p">([</span><span class="s2">&quot;scint&quot;</span><span class="p">,</span> <span class="s2">&quot;I0&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>The <em>easiest</em> way to count the <code class="docutils literal notranslate"><span class="pre">scaler</span></code> object is to use the <a class="reference external" href="https://blueskyproject.io/bluesky/magics.html?highlight=label#taking-a-reading-using-ct-post-v1-3-0">%ct</a> bluesky magic command, which counts all objects with the <code class="docutils literal notranslate"><span class="pre">detectors</span></code> label.</p>
<p>Note that the various magic commands are only available from the command line, not for use in a bluesky plan function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">ct</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[This data will not be saved. Use the RunEngine to collect data.]
noisy                          0.0
I0                             7.0
scint                          9.0
scaler1_time                   1.6
</pre></div></div>
</div>
<p>Compare with the reading when <em>all</em> channels are selected.</p>
<p>NOTE: To report <em>all</em> named channels, call <code class="docutils literal notranslate"><span class="pre">.select_channels()</span></code> with empty parentheses.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler1</span><span class="o">.</span><span class="n">select_channels</span><span class="p">()</span>
<span class="o">%</span><span class="k">ct</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[This data will not be saved. Use the RunEngine to collect data.]
noisy                          0.0
timebase                       16000000.0
I0                             8.0
scint                          7.0
I000                           8.0
I00                            7.0
roi1                           8.0
scaler1_time                   1.6
</pre></div></div>
</div>
<p>Now, select just the two channels again before continuing:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler1</span><span class="o">.</span><span class="n">select_channels</span><span class="p">([</span><span class="s2">&quot;scint&quot;</span><span class="p">,</span> <span class="s2">&quot;I0&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>As noted before, the <code class="docutils literal notranslate"><span class="pre">%ct</span></code> command is only available from the command shell.</p>
<section id="use-ophyd-to-count-the-scaler">
<h3>use ophyd to count the scaler<a class="headerlink" href="#use-ophyd-to-count-the-scaler" title="Link to this heading">#</a></h3>
<p>We should learn how to use the underlying Python code to do the same steps.</p>
<p>The first step is to use pure ophyd methods to count and report, then use a bluesky plan to do the same thing. The ophyd methods are <code class="docutils literal notranslate"><span class="pre">trigger</span></code>, <code class="docutils literal notranslate"><span class="pre">wait</span></code>, and <code class="docutils literal notranslate"><span class="pre">read</span></code>. The <code class="docutils literal notranslate"><span class="pre">trigger</span></code> and <code class="docutils literal notranslate"><span class="pre">wait</span></code> methods can be chained together:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler1</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Technically, we should <code class="docutils literal notranslate"><span class="pre">stage</span></code> and <code class="docutils literal notranslate"><span class="pre">unstage</span></code> the object. <strong>We’ll use staging to control the count time of the scaler.</strong></p>
<p>The ophyd <code class="docutils literal notranslate"><span class="pre">`.stage()</span></code> method &lt;<a class="reference external" href="https://blueskyproject.io/ophyd/generated/ophyd.device.BlueskyInterface.stage.html?highlight=stage#ophyd.device.BlueskyInterface.stage">https://blueskyproject.io/ophyd/generated/ophyd.device.BlueskyInterface.stage.html?highlight=stage#ophyd.device.BlueskyInterface.stage</a>&gt;`__ prepares the object for its <code class="docutils literal notranslate"><span class="pre">.trigger()</span></code> method, while the <code class="docutils literal notranslate"><span class="pre">.unstage()</span></code> method returns the object’s settings to the previous state before the <code class="docutils literal notranslate"><span class="pre">.stage()</span></code> method was called.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler1</span><span class="o">.</span><span class="n">stage</span><span class="p">()</span>
<span class="n">scaler1</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="n">scaler1</span><span class="o">.</span><span class="n">unstage</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Channels(prefix=&#39;gp:scaler1&#39;, name=&#39;scaler1_channels&#39;, parent=&#39;scaler1&#39;, read_attrs=[&#39;chan02&#39;, &#39;chan02.s&#39;, &#39;chan04&#39;, &#39;chan04.s&#39;], configuration_attrs=[&#39;chan02&#39;, &#39;chan02.chname&#39;, &#39;chan02.preset&#39;, &#39;chan02.gate&#39;, &#39;chan04&#39;, &#39;chan04.chname&#39;, &#39;chan04.preset&#39;, &#39;chan04.gate&#39;]),
 ScalerCH(prefix=&#39;gp:scaler1&#39;, name=&#39;scaler1&#39;, read_attrs=[&#39;channels&#39;, &#39;channels.chan02&#39;, &#39;channels.chan02.s&#39;, &#39;channels.chan04&#39;, &#39;channels.chan04.s&#39;, &#39;time&#39;], configuration_attrs=[&#39;channels&#39;, &#39;channels.chan02&#39;, &#39;channels.chan02.chname&#39;, &#39;channels.chan02.preset&#39;, &#39;channels.chan02.gate&#39;, &#39;channels.chan04&#39;, &#39;channels.chan04.chname&#39;, &#39;channels.chan04.preset&#39;, &#39;channels.chan04.gate&#39;, &#39;count_mode&#39;, &#39;delay&#39;, &#39;auto_count_delay&#39;, &#39;freq&#39;, &#39;preset_time&#39;, &#39;auto_count_time&#39;, &#39;egu&#39;])]
</pre></div></div>
</div>
<p>Let’s find out what happens when <code class="docutils literal notranslate"><span class="pre">scaler1</span></code> is staged. That’s controlled by the contents of a Python dictionary <code class="docutils literal notranslate"><span class="pre">.stage_sigs</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler1</span><span class="o">.</span><span class="n">stage_sigs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict()
</pre></div></div>
</div>
<p>It’s empty, so nothing has been preconfigured for us. Let’s make sure that we get to pick the <em>counting time</em> (the time to accumulate pulses in the various channels), say 2.0 seconds, when we count here.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler1</span><span class="o">.</span><span class="n">stage_sigs</span><span class="p">[</span><span class="s2">&quot;preset_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">scaler1</span><span class="o">.</span><span class="n">stage_sigs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;preset_time&#39;, 2)])
</pre></div></div>
</div>
<p>Show the counting time <em>before</em> we count, then <code class="docutils literal notranslate"><span class="pre">stage</span></code>, <code class="docutils literal notranslate"><span class="pre">trigger</span></code>, <code class="docutils literal notranslate"><span class="pre">wait</span></code>, <code class="docutils literal notranslate"><span class="pre">read</span></code>, <code class="docutils literal notranslate"><span class="pre">unstage</span></code>, then finally show the counting time <em>after</em> we count:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scaler configured to count for </span><span class="si">{</span><span class="n">scaler1</span><span class="o">.</span><span class="n">preset_time</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<span class="n">scaler1</span><span class="o">.</span><span class="n">stage</span><span class="p">()</span>
<span class="n">scaler1</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scaler1</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">scaler1</span><span class="o">.</span><span class="n">unstage</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scaler configured to count for </span><span class="si">{</span><span class="n">scaler1</span><span class="o">.</span><span class="n">preset_time</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Scaler configured to count for 1.5s
OrderedDict([(&#39;I0&#39;, {&#39;value&#39;: 12.0, &#39;timestamp&#39;: 1681409246.542347}), (&#39;scint&#39;, {&#39;value&#39;: 10.0, &#39;timestamp&#39;: 1681409246.542347}), (&#39;scaler1_time&#39;, {&#39;value&#39;: 2.1, &#39;timestamp&#39;: 1681409244.179794})])
Scaler configured to count for 1.5s
</pre></div></div>
</div>
<p>The report from <code class="docutils literal notranslate"><span class="pre">.read()</span></code> includes both values and timestamps (in seconds since the Python <a class="reference external" href="https://docs.python.org/3/library/time.html">time</a> epoch, UTC). The structure is a Python dictionary. This is the low-level method used to collect readings from any ophyd device. We had to <code class="docutils literal notranslate"><span class="pre">print()</span></code> this since the return result from a command within a sequence is not returned at the end of the sequence, just the return result of the <em>final</em> command in the sequence.</p>
<p>See that the scaler counted for 2.1 seconds (a small bug in the scaler simulator it seems, always adds .1 to the count time!). But before staging, the scaler was configured for 1.0 seconds, and after unstaging, the scaler returned to that value.</p>
<p><strong>That’s how to control the counting time for a scaler.</strong> (Area detectors use different terms. More on that later.)</p>
<details><summary><p>about scaler1_time</p>
</summary><p>Of note is the key <code class="docutils literal notranslate"><span class="pre">scaler1_time</span></code> which is the name of the ophyd symbol <code class="docutils literal notranslate"><span class="pre">scaler1.time</span></code> as returned by <code class="docutils literal notranslate"><span class="pre">scaler1.time.name</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>In [21]: scaler1.time.name
    Out [21]: &#39;scaler1_time&#39;
</pre></div>
</div>
</details></section>
<section id="use-bluesky-(the-package)-to-count-the-scaler">
<h3>use bluesky (the package) to count the scaler<a class="headerlink" href="#use-bluesky-(the-package)-to-count-the-scaler" title="Link to this heading">#</a></h3>
<p>Now, use the bluesky <a class="reference external" href="https://blueskyproject.io/bluesky/generated/bluesky.run_engine.RunEngine.html?highlight=runengine#bluesky.run_engine.RunEngine">RunEngine</a> (<code class="docutils literal notranslate"><span class="pre">RE</span></code>) to count <code class="docutils literal notranslate"><span class="pre">scaler1</span></code>. We’ll use the bluesky plan (<a class="reference external" href="https://blueskyproject.io/bluesky/plans.html?highlight=count#pre-assembled-plans">bp</a>) called <a class="reference external" href="https://blueskyproject.io/bluesky/generated/bluesky.plans.count.html#bluesky.plans.count">count()</a>. To be consistent with the result returned from <code class="docutils literal notranslate"><span class="pre">%ct</span></code>, we’ll include the
<code class="docutils literal notranslate"><span class="pre">noisy</span></code> detector.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">count</span><span class="p">([</span><span class="n">scaler1</span><span class="p">,</span><span class="n">noisy</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 932     Time: 2023-04-13 13:07:26
Persistent Unique Scan ID: &#39;de519ff4-fb72-4f15-8ee3-d0b11db127da&#39;
New stream: &#39;label_start_motor&#39;
New stream: &#39;primary&#39;
+-----------+------------+------------+------------+------------+
|   seq_num |       time |      noisy |         I0 |      scint |
+-----------+------------+------------+------------+------------+
|         1 | 13:07:28.9 |    0.00000 |         12 |          8 |
+-----------+------------+------------+------------+------------+
generator count [&#39;de519ff4&#39;] (scan num: 932)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;de519ff4-fb72-4f15-8ee3-d0b11db127da&#39;,)
</pre></div></div>
</div>
<p>There are many ways to view data from bluesky runs. The most recent run can be picked from the database using the Python reference for <em>the last item in the list</em>: <code class="docutils literal notranslate"><span class="pre">[-1]</span></code>. We need the <code class="docutils literal notranslate"><span class="pre">v2</span></code> version of the database to access the <code class="docutils literal notranslate"><span class="pre">.primary</span></code> data stream.</p>
<p>We’ll pick one simple to view the run data, as an <a class="reference external" href="http://xarray.pydata.org/">xarray</a> table since it is easy to display such structured content in a Jupyter notebook. (We could just as easily have displayed the data as a <a class="reference external" href="https://dask.org/">dask</a> table by replacing <code class="docutils literal notranslate"><span class="pre">.read()</span></code> with <code class="docutils literal notranslate"><span class="pre">.to_dask()</span></code>.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:       (time: 1)
Coordinates:
  * time          (time) float64 1.681e+09
Data variables:
    noisy         (time) float64 0.0
    I0            (time) float64 12.0
    scint         (time) float64 8.0
    scaler1_time  (time) float64 2.1</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-d37f6960-49a7-4937-975b-4577797a6214' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d37f6960-49a7-4937-975b-4577797a6214' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 1</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-5b2d8c76-784c-488b-9220-06735a309006' class='xr-section-summary-in' type='checkbox'  checked><label for='section-5b2d8c76-784c-488b-9220-06735a309006' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.681e+09</div><input id='attrs-e7f088e9-ca4f-4178-a1cd-407af52effd7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e7f088e9-ca4f-4178-a1cd-407af52effd7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b3426459-ce86-4f18-b583-7c63ffc18004' class='xr-var-data-in' type='checkbox'><label for='data-b3426459-ce86-4f18-b583-7c63ffc18004' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1.681409e+09])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-74076366-b19b-4a8c-af5c-aef6e0a2eb67' class='xr-section-summary-in' type='checkbox'  checked><label for='section-74076366-b19b-4a8c-af5c-aef6e0a2eb67' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>noisy</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0</div><input id='attrs-ff42b813-2fa7-4380-bef4-d52916c9e459' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ff42b813-2fa7-4380-bef4-d52916c9e459' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fbf0f446-fc35-40f1-8bfa-cf68dc620ee8' class='xr-var-data-in' type='checkbox'><label for='data-fbf0f446-fc35-40f1-8bfa-cf68dc620ee8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>noisy</dd></dl></div><div class='xr-var-data'><pre>array([0.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>I0</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>12.0</div><input id='attrs-3cef4bb1-162a-4b80-9376-5aec80b358d4' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-3cef4bb1-162a-4b80-9376-5aec80b358d4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-615c13ca-b801-4261-af25-c217085bc249' class='xr-var-data-in' type='checkbox'><label for='data-615c13ca-b801-4261-af25-c217085bc249' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>scaler1</dd></dl></div><div class='xr-var-data'><pre>array([12.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>scint</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>8.0</div><input id='attrs-e93d1a09-afaf-4151-a9d3-f2bc42216dea' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-e93d1a09-afaf-4151-a9d3-f2bc42216dea' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-72492b60-9496-45e1-8d99-e41d16683364' class='xr-var-data-in' type='checkbox'><label for='data-72492b60-9496-45e1-8d99-e41d16683364' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>scaler1</dd></dl></div><div class='xr-var-data'><pre>array([8.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>scaler1_time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>2.1</div><input id='attrs-ddcce92d-7174-416e-80dc-05318678c0ea' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ddcce92d-7174-416e-80dc-05318678c0ea' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-58ff9953-a513-4eea-abd6-789da6890d39' class='xr-var-data-in' type='checkbox'><label for='data-58ff9953-a513-4eea-abd6-789da6890d39' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>scaler1</dd></dl></div><div class='xr-var-data'><pre>array([2.1])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b6c27c14-0f4d-492a-8148-c75aa6494f74' class='xr-section-summary-in' type='checkbox'  ><label for='section-b6c27c14-0f4d-492a-8148-c75aa6494f74' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-900dac90-9303-44f7-a93d-71fade32c316' class='xr-index-data-in' type='checkbox'/><label for='index-900dac90-9303-44f7-a93d-71fade32c316' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([1681409248.9635038], dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-5171a4bb-26ab-4baa-82ff-69e734f99f7f' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-5171a4bb-26ab-4baa-82ff-69e734f99f7f' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<p>As a last action in this section, use the <a class="reference external" href="https://bcda-aps.github.io/apstools/latest/api/_utils.html#apstools.utils.list_runs.listruns">listruns()</a> command from <em>apstools</em> to show the (default: 20) most recent runs in the database. The table shows a short version of the run’s unique identifier (<code class="docutils literal notranslate"><span class="pre">short_uid</span></code>), and other more obvious columns of information, truncated to avoid lengthy output. The name of the <a class="reference external" href="https://blueskyproject.io/databroker/index.html">databroker catalog</a>
(<code class="docutils literal notranslate"><span class="pre">class_2021_03</span></code>) is shown before the table.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listruns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/prjemian/.conda/envs/bluesky_2023_2/lib/python3.10/site-packages/databroker/queries.py:89: PytzUsageWarning: The zone attribute is specific to pytz&#39;s interface; please migrate to a new time zone provider. For more details on how to do so, see https://pytz-deprecation-shim.readthedocs.io/en/latest/migration.html
  timezone = lz.zone
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
======= =================== ========= ==========================
scan_id time                plan_name detectors
======= =================== ========= ==========================
932     2023-04-13 13:07:26 count     [&#39;scaler1&#39;, &#39;noisy&#39;]
931     2023-04-13 13:06:44 count     [&#39;scaler1&#39;, &#39;noisy&#39;]
930     2023-04-11 18:48:34 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
929     2023-04-11 18:48:09 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
928     2023-04-11 18:47:57 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
927     2023-04-11 18:47:42 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
926     2023-04-11 18:47:33 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
925     2023-04-11 18:46:11 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
924     2023-04-11 18:45:11 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
923     2023-04-11 18:44:49 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
922     2023-04-11 18:42:15 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
921     2023-04-11 18:41:39 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
920     2023-04-11 18:41:23 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
919     2023-04-11 18:41:15 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
918     2023-04-11 18:40:39 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
917     2023-04-11 18:39:11 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
916     2023-04-11 18:38:51 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
915     2023-04-11 18:38:36 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
914     2023-04-11 18:38:27 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
913     2023-04-11 18:36:37 scan      [&#39;noisy&#39;, &#39;th_tth_permit&#39;]
======= =================== ========= ==========================
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
CA.Client.Exception...............................................
    Warning: &#34;Virtual circuit disconnect&#34;
    Context: &#34;zap:45763&#34;
    Source File: ../cac.cpp line 1237
    Current Time: Thu Apr 13 2023 16:55:17.301061478
..................................................................
CA.Client.Exception...............................................
    Warning: &#34;Virtual circuit disconnect&#34;
    Context: &#34;zap:5064&#34;
    Source File: ../cac.cpp line 1237
    Current Time: Thu Apr 13 2023 16:55:30.733410696
..................................................................
</pre></div></div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="_bluesky_queueserver.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">First steps with bluesky-queueserver</p>
      </div>
    </a>
    <a class="right-next"
       href="_custom_heater_positioner.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Heater Simulation using synApps epid and transform records</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Start-the-instrument-package">Start the <code class="docutils literal notranslate"><span class="pre">instrument</span></code> package</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#A-closer-look-at-the-EPICS-scaler">A closer look at the EPICS scaler</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-ophyd-to-count-the-scaler">use ophyd to count the scaler</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-bluesky-(the-package)-to-count-the-scaler">use bluesky (the package) to count the scaler</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/howto/_count_scaler.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, APS BCDA.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>